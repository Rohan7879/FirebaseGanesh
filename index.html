<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Estimate Input Form</title>
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- NEW: Libraries for PDF and Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script src="bill.js"></script>
    <link rel="stylesheet" href="html.css" />
    <style>
      /* Simple styles for the bill list view */
      #bill_list_view {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #e9ecef;
      }
      .bill-list-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      .bill-list-table th,
      .bill-list-table td {
        border: 1px solid #dee2e6;
        padding: 8px 12px;
        text-align: left;
      }
      .bill-list-table th {
        background-color: #f8f9fa;
        font-weight: 600;
      }
      .action-buttons button {
        margin-right: 5px;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .view-btn {
        background-color: #007bff;
        color: white;
      }
      .delete-btn {
        background-color: #dc3545;
        color: white;
      }
      /* NEW: Styles for export section */
      .export-section {
        margin-top: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .export-section select {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ced4da;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <img src="IMG-20250716-WA0121.jpg" alt="Company Logo" class="logo" />
        <h1>Bill Details</h1>
      </div>

      <!-- Bill Creation Form -->
      <div id="bill_creation_form">
        <form id="estimateForm">
          <!-- Customer Details Section -->
          <div class="customer-details-section">
            <h3>Customer Details</h3>
            <table>
              <tbody>
                <tr>
                  <td><strong>નામ (Name)</strong></td>
                  <td><input type="text" name="customer_name" /></td>
                  <td><strong>ગાડી નં (Vehicle No.)</strong></td>
                  <td><input type="text" name="vehicle_no" /></td>
                </tr>
                <tr>
                  <td><strong>ગામ (Village)</strong></td>
                  <td><input type="text" name="village" /></td>
                  <td><strong>દલાલ (Broker)</strong></td>
                  <td><input type="text" name="broker" /></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="master-toggle-container">
            <strong>બિલનો પ્રકાર:</strong>
            <label class="switch">
              <input type="checkbox" id="loose_supply_toggle" name="is_loose_supply" />
              <span class="slider"></span>
            </label>
            <strong>લૂઝ સપ્લાય બિલ (Loose Supply)</strong>
          </div>

          <table>
            <tbody>
              <tr>
                <td><strong>વેબ્રીજ વજન</strong></td>
                <td colspan="4">
                  <input type="number" name="weighbridge_weight" required />
                </td>
              </tr>
            </tbody>
            <tbody id="loose_supply_section" style="display: none">
              <tr>
                <td><strong>ભાવ (Price)</strong></td>
                <td colspan="4">
                  <input type="number" name="loose_price" id="loose_price_input" />
                </td>
              </tr>
            </tbody>
            <tbody id="bag_supply_section">
              <tr>
                <td rowspan="2"><strong>બારદાન</strong></td>
                <td style="font-weight: bold; color: #005a9e">કંતાન (૬૦૦ ગ્રામ)</td>
                <td>ભરેલા: <input type="number" name="bharela_600" style="width: 80px" /></td>
                <td>ખાલી: <input type="number" name="khali_600" style="width: 80px" /></td>
                <td class="toggle-cell-container">
                  <label class="switch">
                    <input type="checkbox" name="deduct_kantan" checked />
                    <span class="slider"></span>
                  </label>
                </td>
              </tr>
              <tr>
                <td style="font-weight: bold; color: #005a9e">પ્લાસ્ટિક (૨૦૦ ગ્રામ)</td>
                <td>ભરેલા: <input type="number" name="bharela_200" style="width: 80px" /></td>
                <td>ખાલી: <input type="number" name="khali_200" style="width: 80px" /></td>
                <td class="toggle-cell-container">
                  <label class="switch">
                    <input type="checkbox" name="deduct_plastic" checked />
                    <span class="slider"></span>
                  </label>
                </td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td style="border-bottom: 2px solid #dee2e6"></td>
                <td colspan="4" class="checkbox-cell" style="border-bottom: 2px solid #dee2e6">
                  <div class="toggle-container">
                    <strong>ઉતરાઈ કપાત કરવી (Deduct Unloading)</strong>
                    <label class="switch">
                      <input type="checkbox" name="deduct_utrai" checked />
                      <span class="slider"></span>
                    </label>
                  </div>
                </td>
              </tr>
            </tbody>
            <tbody id="vakal_section">
              <tr>
                <td><strong>વકલ ૧</strong></td>
                <td>કટ્ટા</td>
                <td><input type="number" name="vakal_1_katta" /></td>
                <td>ભાવ</td>
                <td><input type="number" name="vakal_1_bhav" /></td>
              </tr>
              <tr>
                <td><strong>વકલ ૨</strong></td>
                <td>કટ્ટા</td>
                <td><input type="number" name="vakal_2_katta" /></td>
                <td>ભાવ</td>
                <td><input type="number" name="vakal_2_bhav" /></td>
              </tr>
              <tr>
                <td><strong>વકલ ૩</strong></td>
                <td>કટ્ટા</td>
                <td><input type="number" name="vakal_3_katta" /></td>
                <td>ભાવ</td>
                <td><input type="number" name="vakal_3_bhav" /></td>
              </tr>
              <tr>
                <td><strong>વકલ ૪</strong></td>
                <td>કટ્ટા</td>
                <td><input type="number" name="vakal_4_katta" /></td>
                <td>ભાવ</td>
                <td><input type="number" name="vakal_4_bhav" /></td>
              </tr>
              <tr>
                <td><strong>વકલ ૫</strong></td>
                <td>કટ્ટા</td>
                <td><input type="number" name="vakal_5_katta" /></td>
                <td>ભાવ</td>
                <td><input type="number" name="vakal_5_bhav" /></td>
              </tr>
            </tbody>
          </table>

          <div class="expense-section">
            <h3>અન્ય ખર્ચ (Other Expenses)</h3>
            <div id="expense_list"></div>
            <button type="button" class="add-expense-btn" onclick="addExpense()">+ ખર્ચ ઉમેરો (Add Expense)</button>
          </div>

          <button type="submit">Generate Bill</button>
        </form>
      </div>

      <!-- View for listing all saved bills -->
      <div id="bill_list_view" style="display: none">
        <h2>Saved Bills</h2>
        <button onclick="showBillCreationForm()" class="button back-button" style="margin-bottom: 15px">
          Create New Bill
        </button>
        <div id="sync_status" style="text-align: right; margin-bottom: 10px; font-weight: bold">Syncing...</div>

        <!-- NEW: Export Section -->
        <div class="export-section">
          <label for="export_format">Export Format:</label>
          <select id="export_format">
            <option value="excel">Excel (XLSX)</option>
            <option value="pdf">PDF</option>
          </select>
          <button class="button" style="background-color: #17a2b8" onclick="exportSelectedBills()">
            Download Selected
          </button>
        </div>

        <table class="bill-list-table">
          <thead>
            <tr>
              <th><input type="checkbox" onchange="toggleSelectAll(this)" /></th>
              <th>Bill No.</th>
              <th>Date</th>
              <th>Name</th>
              <th>Bill Type</th>
              <th>Final Total</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="bill_list_body">
            <!-- Bill rows will be inserted here by JavaScript -->
          </tbody>
        </table>
      </div>
      <button
        type="submit"
        onclick="showBillListView()"
        id="view_all_bills_btn"
        class="button"
        style="width: 100%; margin-top: 20px; background-color: #6c757d"
      >
        View Saved Bills
      </button>
    </div>
  </body>
</html>
